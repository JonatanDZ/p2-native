<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Events Page</title>
    <link rel="stylesheet" href="/public/css/components/event.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div id="navbar"></div>
    <div class="customContainer">
      <div id="sidebar-container"></div>
      <div class="events-container" id="events-container"></div>
    </div>
    <div id="footer"></div>
    <script src="/public/js/components/sidebarEvent.js"></script>
    <script src="/public/js/components/navbar.js"></script>
    <script src="/public/js/components/footer.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("events.json")
          .then((response) => response.json())
          .then((events) => {
            const eventsContainer = document.getElementById("events-container");

            events.forEach((event) => {
              const eventCard = document.createElement("div");
              eventCard.classList.add("event-card");

              eventCard.innerHTML = `
                            <!--a href="event-detail.html?id=${event.id}" class="event-link"-->
                                <img src="${event.image}" alt="${event.name}" class="event-link">
                                <h3>${event.name}</h3>
                                <p>${event.info}</p>
                                <p class="event-price">${event.price}</p>
                            <!--/a-->
                        `;

              eventsContainer.appendChild(eventCard);
            });
            ///////////////////////////////
            //When clicking event, add to user_events table (which is used for event reccomender)
            let event_number = document.getElementsByClassName("event-link");
            for (let i = 0; i < event_number.length; i++) {
              event_number[i].addEventListener("click", async function () {
                console.log("CLICKED!");
                const userID = 2; //Insert userID here (somehow)
                const eventID = events[i].id;
                //Make a POST with userID and eventID
                try {
                  const response = await fetch(
                    "http://localhost:3000/event-detail",
                    {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify({ userID, eventID }),
                    }
                  );
                } catch (err) {
                  console.error("Error:", err);
                  alert("Something went wrong. Try again.");
                }
              });
              //////////////////////
            }
          })

          .catch((error) => console.error("Error fetching events:", error));
      });
    </script>
  </body>
</html>
