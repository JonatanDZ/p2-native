<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Detail Test Site</title>
    <link rel="stylesheet" href="/public/css/components/navbar.css" />
    <link rel="stylesheet" href="/public/css/components/footer.css" />
    <link rel="stylesheet" href="/public/css/global.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        text-align: center;
        background-color: #f4f4f4;
      }
      .container {
        max-width: 600px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
      }
      img {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 10px;
      }
      h1 {
        font-size: 28px;
        margin: 10px 0;
      }
      p {
        font-size: 18px;
        font-weight: bold;
      }
      button {
        padding: 10px 20px;
        margin: 10px 0;
        font-size: 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .image-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        margin: 20px 0;
      }

      .image-container .card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 13%;
        background-color: #fff;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .image-container .card:hover {
        transform: scale(1.05);
      }

      .image-container .card img {
        width: 100%;
        height: 300px;
        object-fit: cover;
      }
      .scrollmenu.image-container {
        display: block;
        overflow-x: auto !important;
        white-space: nowrap !important;
        padding: 10px;
      }

      .scrollmenu.image-container > div {
        display: inline-block;
        vertical-align: top;
        width: 350px;
        margin-right: 10px;
        border: 1px solid #ccc;
        padding: 10px;
        box-sizing: border-box;
      }

      #detail-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 10px;
        max-width: 400px;
        margin: auto;
      }

      #detail-container.image-container {
        flex-direction: column !important;
        align-items: center !important;
        text-align: center;
      }
    </style>
  </head>

  <body>
    <div id="navbar"></div>
    <div class="image-container" id="detail-container">Loading...</div>
    <h2>Anbefalede varer</h2>
    <div class="scrollmenu image-container" id="recommendation-list"></div>

    <h2>Lignende varer</h2>
    <div class="scrollmenu image-container" id="similarItems-list"></div>

    <div id="footer"></div>
    <script src="/public/js/components/navbar.js"></script>
    <script src="/public/js/components/footer.js"></script>
    <script src="/public/js/products/viewbyid.js"></script>
    <!--script>
      document.addEventListener("DOMContentLoaded", loadDetailPage);

      function getProductIdFromUrl() {
        const params = new URLSearchParams(window.location.search);
        return params.get("id");
      }

      async function getUserId() {
        // Get token from localStorage
        const token =
          localStorage.getItem("token") || sessionStorage.getItem("token");

        if (!token) {
          console.warn("No token found");
          return null;
        }

        try {
          // Send POST request to server to verify authentication and admin status
          const response = await fetch("/verify-token", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ token: token }),
          });

          const data = await response.json();

          return await data.userId;
        } catch (err) {
          // Handle fetch errors or server issues
          console.error("Error verifying token:", err);
          localStorage.removeItem("token");
          window.location.href = "/public/pages/login/login.html";
        }
      }

      // Update User filters.
      async function updateUserFiltersHTML() {
        const userId = await getUserId();
        const itemId = getProductIdFromUrl();

        if (!userId || !itemId) {
          console.warn("Missing userId or itemId");
          return;
        }

        try {
          const res = await fetch("/update-user-filters", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ userId, itemId }),
          });
        } catch (err) {
          console.log("Something went wrong", err);
        }
      }

      async function getRecommendedItemsHTML() {
        const userId = await getUserId();

        await fetch(`/recommendItems?userId=${userId}`)
          .then((response) => response.json())
          .then((data) => {
            console.log("Recommendations:", data);
            displayRecommendedItems(data);
          })
          .catch((err) => {
            console.error("Failed to load recommendations:", err);
          });
      }

      async function displayRecommendedItems(recommendationList) {
        const top10 = recommendationList.slice(0, 10);

        if (top10.length > 0) {
          const allRes = await fetch("/get-products");
          const allProducts = await allRes.json();

          const container = document.getElementById("recommendation-list");
          container.innerHTML = ""; // clear previous content if any

          for (const rec of top10) {
            const product = allProducts.find((p) => p.ID === rec.ID);
            if (!product) continue;

            const itemHTML = document.createElement("div");
            itemHTML.innerHTML = `
                        <img src="${product.picture}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>${product.info}</p>
                        <p>Price: ${product.price} DKK</p>
                        <p>Match Score: ${rec.score}</p>
                        <button onclick='addToBasket(${JSON.stringify(
                          product
                        )})'>Tilføj til kurv</button>
                    `;
            container.appendChild(itemHTML);
          }
        } else {
          const container = document.getElementById("recommendation-list");
          container.innerHTML = ""; // clear previous content if any

          const itemHTML = document.createElement("div");
          itemHTML.innerHTML = `
                    <h3>Login for at se dine anbefalede varer</h3>
                `;
          container.appendChild(itemHTML);
        }
      }

      async function displaySimilarItems(similarItems) {
        // starter fra 1 i stedet for 0, så den ikke viser det samme item som man er trykket ind på.
        const top10 = similarItems.slice(1, 10);

        const allRes = await fetch("/get-products");
        const allProducts = await allRes.json();

        const container = document.getElementById("similarItems-list");
        container.innerHTML = ""; // clear previous content if any
        for (const rec of top10) {
          const product = allProducts.find((p) => p.ID === rec.ID);
          if (!product) continue;

          const itemHTML = document.createElement("div");
          itemHTML.innerHTML = `
                        <img src="${product.picture}" alt="${product.name}">
                        <h3>${product.name}</h3>
                        <p>${product.info}</p>
                        <p>Price: ${product.price} DKK</p>
                        <p>Match Score: ${rec.score}</p>
                        <button onclick='addToBasket(${JSON.stringify(
                          product
                        )})'>Tilføj til kurv</button>
                    `;
          container.appendChild(itemHTML);
        }
      }

      async function getSimilarItems() {
        const itemId = await getProductIdFromUrl();

        await fetch(`/similarItems?itemId=${itemId}`)
          .then((response) => response.json())
          .then((data) => {
            console.log("similar:", data);
            displaySimilarItems(data);
          })
          .catch((err) => {
            console.error("Failed to load similar items:", err);
          });
      }

      updateUserFiltersHTML();
      getRecommendedItemsHTML();
      getSimilarItems();

      // Function to add a product to the basket
      function addToBasket(product) {
        let basket = JSON.parse(localStorage.getItem("basket")) || [];
        const existingProduct = basket.find((item) => item.id === product.id);
        if (existingProduct) {
          existingProduct.quantity = (existingProduct.quantity || 1) + 1;
        } else {
          product.quantity = 1;
          basket.push(product);
        }
        localStorage.setItem("basket", JSON.stringify(basket));
        alert("Produktet er tilføjet til kurven!");
      }
    </script-->
  </body>
</html>
